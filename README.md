# gachi-bot

## Описание 

Гачи-бот для сообществ социальной сети "ВКонтакте". Сделан на коленке ради мемесов и тренировки.

## Установка и применение

К сожалению, пока в репозитории нет файла requirements.txt (но я добавлю, честно), так что вот список всех используемых библиотек.
Необходимо установить следующие библиотеки в виртуальное окружение проекта:

* vkBottle
* sk-learn
* requests  
* panadas
* BeautifulSoup 
* spacy
* nltk

Дальше необходимо получить API-ключ сообщества в "ВКонтакте" и API-ключ от платформы Genius и вставить их в соответсвующие поля в файле bot.py.
В сообществе "ВКонтакте" должен быть активирован long-poll сервер.
Запустить файл bot.py.
Все ;7

### Команды бота 

В сообщениях сообщества боту можно отправить следующие команды:
* Простой текст - бот попытается определить этот текст на сексизм и выдать соотвествующий ответ (размер текста должен быть менее 1500 символов);
* Аудиозапись - бот найдет текст этой записи в базе данных Genius по имени артиста и композиции, выведет текст этой аудизаписи 
и попытается определить сексисткая ли она;
* "отправь гачимикс" - бот отправит один из случайных гачимиксов, что есть в его текстовой базе данных;

## Техническая часть и описание функций и файлов

Файл bot.py содержит следующие функции:

### Генераторы сообщений
* generate_greetings - генерация приветсвия по заранее заготовленным шаблонам и фразам. Приветсвие выдается каждому новому пользователю, или
тому пользователю, что обращался к боту более 24 часов назад; 
* generate_outocome - генрация заключения о том, является ли текст сексистким или нет;
* generate_refusal - генерация отказа или в классификации текста;
* generate_error_refuse - генерация сообещения об ошибке;
### Другие функции
* classify_sexism - функция загружает модель машинного обучения определения сексизма в тексте и классификацирует переданный ей в праметрах функции текст.
* check_user_activity_time - принимает на вход id пользователя и заносит в текстовую базу данных id и его последние время обращения к боту.
* clean_text - принимает на вход текст для классифкации на сексизм и приводит его к чистому виду (удаление знаков препинания и пунктуации, ссылок и приведение в нижний регистр).
* get_music_classification - принимает на вход имя пользователя и информацию об аудиозаписи. Делает запросы к базе данных Genius и вытаскивает текст композиции для классификации.
* get_text_classification - функция-обертка для классификации текста. Проверяет текст на заданное количество символов и формирует ответ пользователяю в зависимости от классификации.
* message_handler - обработчик новых сообщений

### text_preprocess.py

Файл text_preprocess.py содержит описание класса для препроцесса текста. 
Класс содержит методы лемматизации, токенизации, удаления стоп-слов в тексте.

### get_audio_by_id.py

Маленький скрипт для парса id аудифайлов из html-разметки плейлиста из ВК. Таким образом создавалась текстовая база данных гачи-миксов.
Все id сохраняются в файл songs.txt. Файл gachi.html содержит разметку плейлиста с гачимиксами, откуда брались id коипозиций.

### Другие файлы

Папка sexism_model содержит дампы модели машинного обучения определения сексизма в тексте и модели векторизации текста, созданные с помощью библиотеки sklearn.
Папка users содержит excel-таблицу с id пользователь, что пользовались ботом, и время их последнего обращения.

